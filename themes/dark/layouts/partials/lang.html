{{- /* Show only if site has more than one language */ -}}
{{- if hugo.IsMultilingual -}}
  {{- $currentLang := .Site.Language.Lang -}}
  {{- $allLangs := .Site.Languages -}}
  {{- $pageTrans := .AllTranslations -}}
  {{- $homeTrans := .Site.Home.AllTranslations -}}

  <div class="lang-switcher">
    <label for="lang-select" class="lang-label">
      {{ .Site.Language.LanguageName }}
    </label>

    <select id="lang-select"
            onchange="if (this.value) window.location.href=this.value;">
      {{- range $allLangs }}
        {{- $langCode := .Lang -}}
        {{- $label := .LanguageName -}}

        {{- /* Default URL: home page in this language */ -}}
        {{- $url := "" -}}
        {{- range $homeTrans }}
          {{- if eq .Lang $langCode }}
            {{- $url = .RelPermalink -}}
          {{- end }}
        {{- end }}

        {{- /* If this page has a translation in this language, prefer that */ -}}
        {{- range $pageTrans }}
          {{- if eq .Lang $langCode }}
            {{- $url = .RelPermalink -}}
          {{- end }}
        {{- end }}

        <option value="{{ $url }}" {{ if eq $currentLang $langCode }}selected{{ end }}>
          {{ $label }}
        </option>
      {{- end }}
    </select>
  </div>
{{- end -}}

